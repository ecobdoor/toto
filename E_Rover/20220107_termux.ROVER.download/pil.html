<!DOCTYPE HTML>
<html>
<!--
	Selectors & pseudo-class
	https://www.w3schools.com/cssref/css_selectors.asp
	https://www.w3schools.com/cssref/trysel.asp
-->

<head>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta charset="UTF-8" />
	<title>PILOT-BASE-ROVER 0.00</title>
	<link rel="stylesheet" type="text/css" href="pil.css" />
	<style type="text/css">
	</style>
	<!--
	<meta http-equiv="Content-Security-Policy" content="*">

	<script type="text/javascript" src="toto.js"></script>
	<script type="text/javascript" src="Jobgoals.js"></script>
	<script type="text/javascript" src="pil-CFG_old.js"></script>
-->
	<script type="text/javascript" src="pil.js"></script>
</head>
<!--***************************************************
	NOTATIONS
	 _XXX_	Variabkes globales
	 _XXX 	Variables locales d'une fonction
	 xxx 	Variables locales d'une fonction
****************************************************-->
<!--<body onload="Start();">-->

<body>
	<!--
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r122/three.min.js"></script>
	<script type="text/javascript" src="three.js"></script>
		-->
	<div class="kfwork">
		<h1 style="display:inline;">Rover Pilot</h1>
		<h3 style="display:inline;"> 1.00</h3>
		<div class="mv2_table">
			<table>
				<tr>
					<th>Module</th>
					<th>Timer</th>
					<th>TIOS</th>
					<th>EXEC</th>
					<th>Loc</th>
					<th>Rov</th>
				</tr>
				<tr>
					<td>Motors</td>
					<td>
						<div id="divTim_MOTORS"></div>
					</td>
					<td>
						<div id="divTio_MOTORS"></div>
					</td>
					<td>
						<div id="divExe_MOTORS"></div>
					</td>

					<td>
						<div id="divDbgLOC_MOTORS"></div>
					</td>
					<td>
						<div id="divDbgROV_MOTORS"></div>
					</td>
				</tr>
				<tr>
					<td>Datim</td>
					<td>
						<div id="divTim_DATIM"></div>
					</td>
					<td>
						<div id="divTio_DATIM"></div>
					</td>
					<td>
						<div id="divExe_DATIM"></div>
					</td>

					<td>
						<div id="divDbgLOC_DATIM"></div>
					</td>
					<td>
						<div id="divDbgROV_DATIM"></div>
					</td>
				</tr>
				<tr>
					<td>Driver</td>
					<td>
						<div id="divTim_DRIVER"></div>
					</td>
					<td>
						<div id="divExe_DRIVER"></div>
					</td>

					<td>
						<div id="divDbgLOC_DRIVER"></div>
					</td>
					<td>
						<div id="divDbgROV_DRIVER"></div>
					</td>
				</tr>
				<tr>
					<td>Jobgoal</td>
					<td>
						<div id="divTim_JOBGOAL"></div>
					</td>
					<td>
						<div id="divExe_JOBGOAL"></div>
					</td>

					<td>
						<div id="divDbgLOC_JOBGOAL"></div>
					</td>
					<td>
						<div id="divDbgROV_JOBGOAL"></div>
					</td>
				</tr>
				<tr>
					<td>WATCH</td>
					<td>
						<div id="divTim_WATCH"></div>
					</td>
					<td>
						<div id="divTio_WATCH"></div>
					</td>
					<td>
						<div id="divExe_WATCH"></div>
					</td>

					<td>
						<div id="divDbgLOC_WATCH"></div>
					</td>
					<td>
						<div id="divDbgROV_WATCH"></div>
					</td>
				</tr>
				<tr>
					<td>WSrover</td>
					<td>
						<div id="divTim_WSROV"></div>
					</td>
					<td>
						<div id="divTio_WSROV"></div>
					</td>
					<td>
						<div id="divExe_WSROV"></div>
					</td>

					<td>
						<div id="divDbgLOC_WSROV"></div>
					</td>
					<td>
						<div id="divDbgROV_WSROV"></div>
					</td>
				</tr>
				<tr>
					<td>WSbasis</td>
					<td>
						<div id="divTim_WSBAS"></div>
					</td>
					<td>
						<div id="divTio_WSBAS"></div>
					</td>
					<td>
						<div id="divExe_WSBAS"></div>
					</td>

					<td>
						<div id="divDbgLOC_WSBAS"></div>
					</td>
					<td>
						<div id="divDbgROV_WSBAS"></div>
					</td>
				</tr>
				<tr>
					<td>Filsys</td>
					<td>
						<div id="divTim_FILSYS"></div>
					</td>
					<td>
						<div id="divTio_FILSYS"></div>
					</td>
					<td>
						<div id="divExe_FILSYS"></div>
					</td>

					<td>
						<div id="divDbgLOC_FILSYS"></div>
					</td>
					<td>
						<div id="divDbgROV_FILSYS"></div>
					</td>
				</tr>
				<tr>
					<td>Leds</td>
					<td>
						<div id="divTim_LEDS"></div>
					</td>
					<td>
						<div id="divTio_LEDS"></div>
					</td>
					<td>
						<div id="divExe_LEDS"></div>
					</td>

					<td>
						<div id="divDbgLOC_LEDS"></div>
					</td>
					<td>
						<div id="divDbgROV_LEDS"></div>
					</td>
				</tr>
			</table>
		</div>
		<div id="frame" class="frameer"></div>
		<div id="fixMen" class="fixMener">
			<button name="button" class="emergencyBtn" type="button" onclick="RESET()"></button>
		</div>
		<!--
			RIGHT CONTAINER
		-->
		<div id="verticalMenu" class="verticalMenuer">
			<button id="ADMIN" class="bigBtn" type="button" onclick="ADMIN(this)">ADMIN</button>
			<button id="DRIVE" class="bigBtn" type="button" onclick="DRIVE(this)">DRIVE</button>
			<button id="LEARN" class="bigBtn" type="button" onclick="LEARN(this)">LEARN</button>
			<button id="ROAM" class="bigBtn" type="button" onclick="ROAM(this)">ROAM</button>
			<button id="WORK" class="bigBtn" type="button" onclick="WORK(this)">WORK</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
			<button id="btn_" class="bigBtn" type="button">-</button>
		</div>
		<!--
			FOOT CONTAINER
		-->
		<div id="FOOT">
			<div id="horizontalMenu" class="horizontalMenuer">
				<!-- Set one default Hactive button -->
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER')">
					View all</button>
				<button name="button" class="toyBtn Hactive" type="button" onclick="showView('CENTER','ATTITUDE')">
					Attitude</button>
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER','MAP')">
					Map</button>
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER','M3D')">
					M3D</button>
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER','IMU')">
					Imu</button>
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER','MOTORS')">
					Motors</button>
				<button name="button" class="toyBtn" type="button" onclick="showView('CENTER','WORKJOB')">
					Workjob</button>
				<button name="button" class="toyBtn" type="button">3</button>
				<button name="button" class="toyBtn" type="button">4</button>
				<button name="button" class="toyBtn" type="button">5</button>
				<button name="button" class="toyBtn" type="button">6</button>
				<button name="button" class="toyBtn" type="button">7</button>
				<button name="button" class="toyBtn" type="button">8</button>
			</div>
		</div>
		<!--
			HEAD CONTAINER
		-->
		<div id="HEAD">
			<div id="IOworkjob_container" class="IOworkjob_container IOworkjob_container_default"></div>
			<div id="CTLKMD_container" class="CTLKMD_container CTLKMD_container_default">
				<form onsubmit="return (envoiManualKommand(this.submited));">
					<table>
						<tr>
							<td><input type="text" name="ModKmd" id="ModKmd" style="width: 130px;" /></td>
							<td><input id="wsB" type="submit" onclick="this.form.submited=this.id;" value="BASIS"
									style="width: 50px;" /></td>
							<td><input id="wsR" type="submit" onclick="this.form.submited=this.id;" value="ROVER"
									style="width: 50px;" /></td>
						</tr>
					</table>
				</form>
			</div>
		</div>
		<div id="log" class="logger"></div>
		<!--
			CENTER CONTAINER
		-->
		<div id="CENTER">
			<div id="ATTITUDE" class="ATTITUDE ATTITUDE_default"></div>
			<div id="WORKJOB" class="WORKJOB WORKJOB_default">
				<div id="divExe_WORKJOB"></div>
				<div id="divInfo_WORKJOB">
					Durant l'exécution de la mission, le rover est autonome & le pilote peut se
					déconnecter.
					Sinon le n° de ligne du fichier est affiché toutes le 2 secondes. Et les lignes de commentaire
					sont renvoyées.
				</div>
			</div>
			<div id="MOTORS" class="MOTORS MOTORS_default">
				<canvas id="DRVcanvas" width="300" height="100" style="border: 1px solid #000000;">
					Message pour les navigateurs ne supportant pas encore canvas.
				</canvas>
				<canvas id="MOTcanvas" width="300" height="100" style="border: 1px solid #000000;">
					Message pour les navigateurs ne supportant pas encore canvas.
				</canvas>
			</div>
			<div id="MAP" class="MAP MAP_default">
				<canvas id="MAPcanvas" width="300" height="256" style="border: 1px solid #000000;">
					Message pour les navigateurs ne supportant pas encore canvas.
				</canvas>
			</div>
			<div id="M3D" class="M3D M3D_default">
				<!--
				<canvas id="M3Dcanvas" width="300" height="256" style="border: 1px solid #000000;">
					Message pour les navigateurs ne supportant pas encore canvas.
				</canvas>
				-->
			</div>
			<div id="IMU" class="IMU IMU_default">
				<canvas id="IMUcanvas" width="300" height="256" style="border: 1px solid #000000;">
					Message pour les navigateurs ne supportant pas encore canvas.
				</canvas>
			</div>
		</div>

		<!--
			JOYSTICK CONTAINER
		-->
		<div id="JOYSTICK" style="z-index: 100;">
			<div class="examplediv"></div>
			<div id="mv2_pilotVreticle"></div>
			<div id="mv2_pilotHreticle"></div>
			<div id="mv2_pilotJS" class="mv2_pilotJS">
				<div id="mv2_pilotCursor"></div>
			</div>
			<div id="mv2_pilotJSBackground" class="mv2_pilotJS" style="pointer-events: none;"></div>
		</div>
	</div>
	<script type="text/javascript">
		window.onload = Start;//Start();
	</script><script type="module">
	//document.domain = "github.com";
//	import * as THREE from '../build/three.module.js';
//import * as THREE from 'https://github.com/mrdoob/three.js/blob/dev/build/three.js';
import * as THREE from 'https://github.com/mrdoob/three.js/blob/dev/build/three.js';
			import { OrbitControls } from './jsm/controls/OrbitControls.js';
//	<script type="text/javascript">
		//	
		/**@abstract
		https://discoverthreejs.com/book/first-steps/transformations/
		https://discoverthreejs.com/book/first-steps/camera-controls/
		https://github.com/mrdoob/three.js/tree/master/examples/jsm/controls
		*/
		let camera, controls, scene, renderer,cylinder;
		init();
		//render(); // remove when using next line for animation loop (requestAnimationFrame)
		animate();

		function init() {
			 scene = new THREE.Scene()
			 renderer = new THREE.WebGLRenderer()

			var container = document.getElementById('M3D');
			var w = container.offsetWidth;
			var h = container.offsetHeight;

			 camera = new THREE.PerspectiveCamera(75, w / h, 0.1, 1000)

			const geometry = new THREE.CylinderGeometry(5, 5, 20, 32)
			const material = new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: true})
			 cylinder = new THREE.Mesh(geometry, material)

			scene.add(cylinder)
			camera.position.z = 20

			renderer.setSize(w, h)
			container.appendChild(renderer.domElement)
		}
		function animate() {
			/*
			*/
			cylinder.rotation.x += 0.01
			cylinder.rotation.y += 0.01
			render()
			requestAnimationFrame(animate)
		}
		function render() {
			renderer.render(scene, camera)
		}
		var mouseCol;
		var mouseRow;
		var mouseListen = false;
		container.addEventListener('mousedown', function (e) {
			//var rect = e.target.getBoundingClientRect();
			mouseCol = e.clientX;//- rect.left;
			mouseRow = e.clientY;// - rect.top;
			mouseListen = true;
		});
		container.addEventListener('mousemove', function (e) {
			if (mouseListen) {
				//var rect = e.target.getBoundingClientRect();
				var dx = e.clientX - mouseCol;// - rect.left;
				var dy = e.clientY - mouseRow;// - rect.top;
				var vect3 = new THREE.Vector3();
				var matrixWorld = new THREE.Matrix4();
				matrixWorld = camera.matrixWorld;
				var matrixWorldInverse = new THREE.Matrix4();
				matrixWorldInverse = camera.matrixWorldInverse;
				var projectionMatrix = new THREE.Matrix4();
				projectionMatrix = camera.projectionMatrix;
				var projectionMatrixInverse = new THREE.Matrix4();
				projectionMatrixInverse = camera.projectionMatrixInverse;

				camera.getWorldDirection(vect3);
				console.info("Dxy(" + dx + "," + dy + ") vect3(" + vect3.x + "," + vect3.y + "," + vect3.z + ")");
				vect3.x += dx;
				vect3.y += dy;
				camera.lookAt(vect3);
				mouseCol = e.clientX;// - rect.left;
				mouseRow = e.clientY;// - rect.top;
			}
		});
		container.addEventListener('mouseup', function (e) {
			//var rect = e.target.getBoundingClientRect();
			mouseCol = e.clientX;// - rect.left;
			mouseRow = e.clientY;// - rect.top;
			mouseListen = false;
		});

		animate()
	</script>
</body>

</html>